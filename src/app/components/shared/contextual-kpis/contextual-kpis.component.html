<div class="contextual-kpis">
  <header class="contextual-kpis__header">
    <h3 class="contextual-kpis__title">KPIs Clave</h3>
    <p class="contextual-kpis__subtitle">vs. Semana Pasada</p>
  </header>

  <div class="contextual-kpis__grid">
    <article
      *ngFor="let kpi of kpis; trackBy: trackByKPI"
      class="contextual-kpis__card"
      [ngClass]="getCardClasses(kpi)"
    >
      <header class="contextual-kpis__card-header">
        <app-icon
          class="contextual-kpis__icon"
          [name]="getValueIcon(kpi)"
          [size]="28"
          aria-hidden="true"
        ></app-icon>
        <span
          *ngIf="showTrends"
          class="contextual-kpis__trend"
          [ngClass]="getTrendClasses(kpi)"
        >
          <app-icon
            class="contextual-kpis__trend-icon"
            [name]="getTrendIcon(kpi.trend)"
            [size]="14"
            aria-hidden="true"
          ></app-icon>
          <span class="contextual-kpis__trend-percentage">{{ kpi.trendPercentage }}%</span>
        </span>
      </header>

      <div class="contextual-kpis__card-body">
        <div class="contextual-kpis__value" [ngClass]="getValueClasses(kpi)">
          {{ formatValue(kpi.value, kpi.format) }}
        </div>
        <div class="contextual-kpis__label">{{ kpi.title }}</div>
        <div *ngIf="kpi.subtitle" class="contextual-kpis__subtitle-text">{{ kpi.subtitle }}</div>
      </div>

      <div class="contextual-kpis__trend-bar">
        <span
          class="contextual-kpis__trend-fill"
          [ngClass]="getTrendFillClasses(kpi)"
          [style.width.%]="Math.abs(kpi.trendPercentage)"
          aria-hidden="true"
        ></span>
      </div>
    </article>
  </div>
</div>
