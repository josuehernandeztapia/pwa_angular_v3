<!-- Skip Link for Accessibility -->
<a class="skip-link" href="#main-content">Saltar al contenido principal</a>

<div class="admin-shell">
  <header class="admin-header">
    <div class="admin-header__content">
      <div class="admin-header__info">
        <h1 class="admin-title">Panel de Administración</h1>
        <p class="admin-subtitle">Gestión de usuarios y configuración del sistema</p>
      </div>
      <button class="btn btn-primary admin-header__action" type="button" (click)="openCreate()" data-cy="admin-create-user">
        + Nuevo Usuario
      </button>
    </div>
  </header>

  <main id="main-content" class="admin-main">
    <!-- Users Management -->
    <section class="card admin-section">
      <div class="admin-section__header">
        <div>
          <h2 class="section-title">Usuarios del Sistema</h2>
          <p class="section-subtitle">Controla los roles y el estado operativo de cada usuario</p>
        </div>
      </div>

      <div class="admin-table" role="region" aria-live="polite">
        <table class="admin-table__grid">
          <thead>
            <tr>
              <th scope="col">Nombre</th>
              <th scope="col">Correo</th>
              <th scope="col">Rol</th>
              <th scope="col">Estado</th>
              <th scope="col" class="admin-table__actions-header">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuarios; trackBy: trackByUsuario">
              <td>
                <div class="admin-user">
                  <div class="admin-user__avatar" aria-hidden="true">{{ getInitials(usuario.nombre) }}</div>
                  <div class="admin-user__meta">
                    <span class="admin-user__name">{{ usuario.nombre }}</span>
                    <span class="admin-user__email">{{ usuario.email }}</span>
                  </div>
                </div>
              </td>
              <td class="admin-table__email">{{ usuario.email }}</td>
              <td>
                <label class="visually-hidden" [attr.for]="'rol-' + usuario.id">Cambiar rol</label>
                <select
                  class="input input-sm admin-select"
                  [id]="'rol-' + usuario.id"
                  [(ngModel)]="usuario.rol"
                  (ngModelChange)="onEdit(usuario)"
                >
                  <option value="admin">Admin</option>
                  <option value="asesor">Asesor</option>
                  <option value="operaciones">Operaciones</option>
                  <option value="soporte">Soporte</option>
                </select>
              </td>
              <td>
                <span class="admin-status" [ngClass]="usuario.activo ? 'admin-status--active' : 'admin-status--blocked'">
                  {{ usuario.activo ? 'Activo' : 'Bloqueado' }}
                </span>
              </td>
              <td class="admin-table__actions">
                <button
                  class="btn btn-secondary btn-sm"
                  type="button"
                  (click)="toggle(usuario)"
                  [attr.aria-label]="usuario.activo ? 'Bloquear ' + usuario.nombre : 'Desbloquear ' + usuario.nombre"
                >
                  {{ usuario.activo ? 'Bloquear' : 'Desbloquear' }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- System Configuration -->
    <section class="card admin-section">
      <div class="admin-section__header">
        <div>
          <h2 class="section-title">Configuración del Sistema</h2>
          <p class="section-subtitle">Preferencias globales para el entorno operativo</p>
        </div>
      </div>

      <div class="admin-config">
        <div class="admin-config__column">
          <h3 class="config-heading">Configuración General</h3>
          <ul class="config-list">
            <li class="config-item">
              <span>Mantenimiento</span>
              <label class="toggle">
                <input type="checkbox" class="toggle__control">
                <span class="toggle__visual" aria-hidden="true"></span>
              </label>
            </li>
            <li class="config-item">
              <span>Logs de debug</span>
              <label class="toggle">
                <input type="checkbox" class="toggle__control">
                <span class="toggle__visual" aria-hidden="true"></span>
              </label>
            </li>
          </ul>
        </div>

        <div class="admin-config__column">
          <h3 class="config-heading">Límites del Sistema</h3>
          <ul class="config-list">
            <li class="config-item config-item--input">
              <label for="max-users">Max usuarios</label>
              <input id="max-users" type="number" value="50" class="input input-sm admin-number">
            </li>
            <li class="config-item config-item--input">
              <label for="timeout">Timeout (seg)</label>
              <input id="timeout" type="number" value="30" class="input input-sm admin-number">
            </li>
          </ul>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Modal -->
<div class="admin-modal" *ngIf="showModal" (click)="closeModal()" role="presentation">
  <div class="admin-modal__panel" role="dialog" aria-modal="true" aria-labelledby="admin-modal-title" (click)="$event.stopPropagation()">
    <h3 class="admin-modal__title" id="admin-modal-title">{{ editing ? 'Editar Usuario' : 'Crear Usuario' }}</h3>
    <form class="admin-form" (ngSubmit)="save()">
      <label class="admin-form__field">
        <span class="admin-form__label">Nombre</span>
        <input [(ngModel)]="form.nombre" name="nombre" required class="input" />
      </label>
      <label class="admin-form__field">
        <span class="admin-form__label">Email</span>
        <input [(ngModel)]="form.email" name="email" type="email" required class="input" />
      </label>
      <label class="admin-form__field">
        <span class="admin-form__label">Rol</span>
        <select [(ngModel)]="form.rol" name="rol" required class="input">
          <option value="admin">Admin</option>
          <option value="asesor">Asesor</option>
          <option value="operaciones">Operaciones</option>
          <option value="soporte">Soporte</option>
        </select>
      </label>
      <div class="admin-form__actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>
    </form>
  </div>
</div>
