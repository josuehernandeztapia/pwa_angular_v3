<div class="cliente-form">
  <header class="cliente-form__header">
    <nav class="cliente-form__breadcrumb" aria-label="Regresar">
      <button type="button" class="cliente-form__breadcrumb-back" (click)="goBack()">← Volver</button>
      <span class="cliente-form__breadcrumb-separator" aria-hidden="true">/</span>
      <span class="cliente-form__breadcrumb-current">{{ isEditMode ? 'Editar Cliente' : 'Nuevo Cliente' }}</span>
    </nav>
    <h1 class="cliente-form__title">{{ isEditMode ? 'Editar Cliente' : 'Nuevo Cliente' }}</h1>
  </header>

  <form class="cliente-form__form" [formGroup]="clienteForm" (ngSubmit)="onSubmit()">
    <section class="cliente-form__section" aria-labelledby="datos-personales">
      <h2 id="datos-personales" class="cliente-form__section-title">Información Personal</h2>
      <div class="cliente-form__row">
        <div class="cliente-form__field">
          <label class="cliente-form__label" for="name">Nombre Completo *</label>
          <input
            id="name"
            type="text"
            formControlName="name"
            class="cliente-form__input"
            [ngClass]="{ 'cliente-form__input--error': isFieldInvalid('name') }"
            placeholder="Ej. Juan Pérez García"
          >
          <p *ngIf="isFieldInvalid('name')" class="cliente-form__error">
            Nombre completo es requerido
          </p>
        </div>

        <div class="cliente-form__field">
          <label class="cliente-form__label" for="email">Correo Electrónico *</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="cliente-form__input"
            [ngClass]="{ 'cliente-form__input--error': isFieldInvalid('email') }"
            placeholder="juan@ejemplo.com"
          >
          <p *ngIf="isFieldInvalid('email')" class="cliente-form__error">
            <span *ngIf="clienteForm.get('email')?.errors?.['required']">Correo es requerido</span>
            <span *ngIf="clienteForm.get('email')?.errors?.['email']">Formato de correo inválido</span>
          </p>
        </div>
      </div>

      <div class="cliente-form__row">
        <div class="cliente-form__field">
          <label class="cliente-form__label" for="phone">Teléfono *</label>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            class="cliente-form__input"
            [ngClass]="{ 'cliente-form__input--error': isFieldInvalid('phone') }"
            placeholder="5555555555"
          >
          <p *ngIf="isFieldInvalid('phone')" class="cliente-form__error">
            Teléfono es requerido
          </p>
        </div>

        <div class="cliente-form__field">
          <label class="cliente-form__label" for="rfc">RFC</label>
          <input
            id="rfc"
            type="text"
            formControlName="rfc"
            class="cliente-form__input"
            [ngClass]="{ 'cliente-form__input--error': isFieldInvalid('rfc') }"
            placeholder="XAXX010101000"
            (input)="onRfcInput($event)"
          >
          <p *ngIf="isFieldInvalid('rfc')" class="cliente-form__error">
            RFC inválido
          </p>
        </div>
      </div>
    </section>

    <section class="cliente-form__section" aria-labelledby="datos-negocio">
      <h2 id="datos-negocio" class="cliente-form__section-title">Información de Negocio</h2>

      <div class="cliente-form__row">
        <div class="cliente-form__field">
          <label class="cliente-form__label" for="market">Mercado *</label>
          <select
            id="market"
            formControlName="market"
            class="cliente-form__select"
            [ngClass]="{ 'cliente-form__select--error': isFieldInvalid('market') }"
          >
            <option value="">Seleccionar mercado</option>
            <option value="aguascalientes">Aguascalientes</option>
            <option value="edomex">Estado de México</option>
          </select>
          <p *ngIf="isFieldInvalid('market')" class="cliente-form__error">
            Mercado es requerido
          </p>
        </div>

        <div class="cliente-form__field">
          <label class="cliente-form__label" for="flow">Tipo de Producto *</label>
          <select
            id="flow"
            formControlName="flow"
            class="cliente-form__select"
            [ngClass]="{ 'cliente-form__select--error': isFieldInvalid('flow') }"
          >
            <option value="">Seleccionar producto</option>
            <option value="Venta a Plazo">Venta a Plazo</option>
            <option value="Plan de Ahorro">Plan de Ahorro</option>
            <option value="Crédito Colectivo">Crédito Colectivo</option>
            <option value="Venta Directa">Venta Directa</option>
          </select>
          <p *ngIf="isFieldInvalid('flow')" class="cliente-form__error">
            Tipo de producto es requerido
          </p>
        </div>
      </div>

      <div class="cliente-form__field">
        <label class="cliente-form__label" for="notes">Notas Adicionales</label>
        <textarea
          id="notes"
          formControlName="notes"
          class="cliente-form__textarea"
          rows="3"
          placeholder="Información adicional sobre el cliente..."
        ></textarea>
      </div>
    </section>

    <div class="cliente-form__actions">
      <button type="button" class="cliente-form__button cliente-form__button--secondary" (click)="goBack()">
        Cancelar
      </button>
      <button type="submit" class="cliente-form__button cliente-form__button--primary" [disabled]="isLoading">
        {{ isLoading ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Crear Cliente') }}
      </button>
    </div>
  </form>
</div>
