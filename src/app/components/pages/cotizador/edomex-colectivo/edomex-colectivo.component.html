<section class="collective-quote command-container">
  <header class="collective-quote__header">
    <div class="collective-quote__heading">
      <h1 class="collective-quote__title">Cotizador EdoMex Colectivo</h1>
      <p class="collective-quote__subtitle">Genera cotizaciones para grupos de transportistas</p>
    </div>
  </header>

  <section class="collective-quote__summary" *ngIf="quotation">
    <h2 class="collective-quote__section-title">Resumen</h2>
    <div class="collective-quote__summary-grid">
      <article class="collective-quote__summary-card collective-quote__summary-card--success">
        <span class="collective-quote__summary-label">Pago mensual por miembro</span>
        <span class="collective-quote__summary-value">{{ formatCurrency(quotation?.monthlyPaymentPerMember || 0) }}</span>
      </article>
      <article class="collective-quote__summary-card collective-quote__summary-card--info">
        <span class="collective-quote__summary-label">Plazo típico</span>
        <span class="collective-quote__summary-value">60 meses</span>
      </article>
      <article class="collective-quote__summary-card collective-quote__summary-card--accent">
        <span class="collective-quote__summary-label">Meta del grupo</span>
        <span class="collective-quote__summary-value">{{ formatCurrency(quotation?.scenario?.targetAmount || 0) }}</span>
      </article>
    </div>
  </section>

  <div class="collective-quote__layout">
    <section class="collective-quote__panel premium-card">
      <h2 class="collective-quote__panel-title">
        <span class="collective-quote__badge">1</span>
        Configuración del grupo
      </h2>
      <form [formGroup]="configForm" class="collective-quote__form">
        <div class="collective-quote__field">
          <label class="collective-quote__label">Número de miembros *</label>
          <input
            type="number"
            formControlName="memberCount"
            class="collective-quote__input"
            min="5"
            max="50"
            step="1"
            placeholder="10"
          />
          <p class="collective-quote__hint">Entre 5 y 50 miembros</p>
        </div>

        <div class="collective-quote__field">
          <label class="collective-quote__label">Precio de unidad por miembro *</label>
          <div class="collective-quote__input-affix">
            <span>$</span>
            <input
              type="number"
              formControlName="unitPrice"
              class="collective-quote__input"
              min="500000"
              step="1000"
              placeholder="749000"
            />
          </div>
        </div>

        <div class="collective-quote__field">
          <label class="collective-quote__label">Consumo mensual promedio *</label>
          <div class="collective-quote__input-affix">
            <input
              type="number"
              formControlName="avgConsumption"
              class="collective-quote__input"
              min="200"
              step="50"
              placeholder="400"
            />
            <span>litros</span>
          </div>
        </div>

        <div class="collective-quote__field">
          <label class="collective-quote__label">Sobreprecio por litro *</label>
          <div class="collective-quote__input-affix">
            <span>$</span>
            <input
              type="number"
              formControlName="overpricePerLiter"
              class="collective-quote__input"
              min="1"
              step="0.1"
              placeholder="3.0"
            />
          </div>
        </div>

        <div class="collective-quote__field">
          <label class="collective-quote__label">Aportación voluntaria mensual</label>
          <div class="collective-quote__input-affix">
            <span>$</span>
            <input
              type="number"
              formControlName="voluntaryMonthly"
              class="collective-quote__input"
              min="0"
              step="100"
              placeholder="0"
            />
          </div>
        </div>

        <div class="collective-quote__actions">
          <button type="button" class="premium-button" (click)="generateQuotation()" [disabled]="!configForm.valid || isCalculating">
            <ng-container *ngIf="!isCalculating">Generar cotización</ng-container>
            <ng-container *ngIf="isCalculating">Generando…</ng-container>
          </button>
          <button type="button" class="premium-button outline" (click)="resetForm()">Limpiar</button>
        </div>
      </form>
    </section>

    <section class="collective-quote__panel premium-card" *ngIf="quotation; else collectiveInfo">
      <h2 class="collective-quote__panel-title">
        <span class="collective-quote__badge">2</span>
        Resultados del grupo
      </h2>

      <div class="collective-quote__stats">
        <article class="collective-quote__stat">
          <span class="collective-quote__stat-label">Miembros del grupo</span>
          <span class="collective-quote__stat-value">{{ quotation.memberCount }}</span>
        </article>
        <article class="collective-quote__stat">
          <span class="collective-quote__stat-label">Inversión total</span>
          <span class="collective-quote__stat-value">{{ formatCurrency(quotation.totalInvestment) }}</span>
        </article>
        <article class="collective-quote__stat">
          <span class="collective-quote__stat-label">Tiempo a primera entrega</span>
          <span class="collective-quote__stat-value">{{ quotation.scenario.monthsToFirstAward || 'N/A' }} meses</span>
        </article>
        <article class="collective-quote__stat">
          <span class="collective-quote__stat-label">Tiempo a entrega total</span>
          <span class="collective-quote__stat-value">{{ quotation.scenario.monthsToFullDelivery || 'N/A' }} meses</span>
        </article>
      </div>

      <section class="collective-quote__member">
        <h3 class="collective-quote__section-heading">Por miembro</h3>
        <dl class="collective-quote__details">
          <div class="collective-quote__detail"><dt>Precio de unidad</dt><dd>{{ formatCurrency(quotation.unitPrice) }}</dd></div>
          <div class="collective-quote__detail"><dt>Enganche requerido</dt><dd>{{ formatCurrency(quotation.downPaymentPerMember) }}</dd></div>
          <div class="collective-quote__detail"><dt>Meta por miembro</dt><dd>{{ formatCurrency(quotation.scenario.targetPerMember || quotation.downPaymentPerMember) }}</dd></div>
          <div class="collective-quote__detail"><dt>Financiamiento</dt><dd>{{ formatCurrency(quotation.financingPerMember) }}</dd></div>
          <div class="collective-quote__detail"><dt>Pago mensual estimado</dt><dd>{{ formatCurrency(quotation.monthlyPaymentPerMember) }}</dd></div>
        </dl>
      </section>

      <section class="collective-quote__benefits">
        <h3 class="collective-quote__section-heading">Beneficios del grupo</h3>
        <ul>
          <li>Enganche reducido al 15% (vs 25% individual)</li>
          <li>Mejor tasa de interés por volumen</li>
          <li>Gestión centralizada de trámites</li>
          <li>Descuentos por compra en volumen</li>
        </ul>
      </section>

      <section class="collective-quote__timeline" *ngIf="quotation.timeline?.length">
        <h3 class="collective-quote__section-heading">Cronograma de financiamiento</h3>
        <ol>
          <li *ngFor="let milestone of quotation.timeline">
            <div class="collective-quote__timeline-title">{{ milestone.title }}</div>
            <p class="collective-quote__timeline-description">{{ milestone.description }}</p>
            <span class="collective-quote__timeline-meta">{{ milestone.timeframe }}</span>
          </li>
        </ol>
      </section>

      <div class="collective-quote__cta">
        <button type="button" class="premium-button" (click)="proceedToClientCreation()">
          Crear grupo de clientes
        </button>
        <button type="button" class="premium-button outline" (click)="generatePDF()">
          Descargar PDF
        </button>
        <button type="button" class="premium-button ghost" (click)="recalculate()">
          Recalcular
        </button>
      </div>
    </section>

    <ng-template #collectiveInfo>
      <section class="collective-quote__panel premium-card collective-quote__info">
        <h2 class="collective-quote__panel-title">Cotización colectiva EdoMex</h2>
        <ul class="collective-quote__info-list">
          <li>
            <app-icon class="icon-20" name="users" [size]="20"></app-icon>
            <div>
              <h3>Grupos de 5-50 miembros</h3>
              <p>Alcanzan mejores condiciones con 10-20 transportistas</p>
            </div>
          </li>
          <li>
            <app-icon class="icon-20" name="piggy-bank" [size]="20"></app-icon>
            <div>
              <h3>Enganche reducido al 15%</h3>
              <p>Un diferencial clave frente a la modalidad individual (25%)</p>
            </div>
          </li>
          <li>
            <app-icon class="icon-20" name="trending-up" [size]="20"></app-icon>
            <div>
              <h3>Mejores condiciones financieras</h3>
              <p>Tasas de interés preferenciales y descuentos por volumen</p>
            </div>
          </li>
          <li>
            <app-icon class="icon-20" name="clipboard-list" [size]="20"></app-icon>
            <div>
              <h3>Gestión centralizada</h3>
              <p>Automatizamos trámites y entregas escalonadas</p>
            </div>
          </li>
        </ul>
      </section>
    </ng-template>
  </div>
</section>
